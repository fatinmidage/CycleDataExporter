# 电池测试数据处理工具

## 功能简介
本工具用于处理和分析电池测试数据，主要包括以下功能：
1. 循环数据处理与分析
2. 中检数据处理与计算
3. DCR（直流内阻）计算与分析
4. 测试报告自动生成
5. 绘制容量和能量的散点图
6. 绘制中检DCR和DCR增长率的散点图
7. 数据表格自动格式化与样式设置

## 项目结构
```
CycleDataExporter/
├── ZPDataCalculator        # 主程序文件
├── Main.bas                # 主入口模块
├── ZPDataModule.bas        # 中检数据处理模块
├── CycleDataModule.bas     # 循环数据处理模块
├── ReportModule.bas        # 报告生成模块
├── ChartModule.bas         # 图表绘制模块
├── TableStyleModule.bas    # 表格样式模块
├── Utility.bas             # 通用工具函数模块
├── DatabaseUtility.bas     # 数据库操作工具模块
├── NetworkUtility.bas      # 网络操作工具模块
├── ApplicationUtility.bas  # 应用程序工具模块
├── BatteryInfo.cls         # 电池信息类
├── CBatteryCycleRaw.cls    # 电池循环原始数据类
└── CBatteryZPRaw.cls       # 电池中检原始数据类
```

## 主要模块

### ZPDataModule
处理中检数据相关的功能模块，包括：
- 容量和能量数据处理
- DCIR（直流内阻）计算
- DCIR Rise（内阻上升率）计算
- 数据表格生成和格式化

#### 关键功能
1. **基本数据处理**
   - 容量计算
   - 能量计算
   - 容量保持率计算
   - 能量保持率计算
   - 绘制容量和能量的散点图
   - 绘制中检DCR和DCR增长率的散点图

2. **DCIR计算**
   - 90%、50%、10% SOC点的DCIR值计算
   - 计算公式：DCIR = (搁置电压 - 放电电压) / |放电电流| * 1000

3. **DCIR Rise计算**
   - 基于首次测量值的DCIR增长率
   - 计算公式：Rise = (当前值 - 基准值) / 基准值 * 100%

### CycleDataModule
处理循环数据相关的功能模块，包括：
- 循环数据提取与处理
- 循环表格生成
- 循环数据与中检数据的关联

### ChartModule
负责绘制各类图表的模块，包括：
- 容量保持率随循环圈数变化的散点图
- DCIR和DCIR Rise随循环圈数变化的散点图
- 图表样式自动设置与优化

### ReportModule
负责生成最终测试报告的模块，包括：
- 从文件中提取原始数据
- 调用各个模块处理数据
- 生成完整的测试报告

### 数据处理方法
1. **容量计算方式**
   - 仅中检一次：直接使用单次测量数据
   - 三圈中检求平均值：连续三次测量取平均值

2. **DCIR测量条件**
   - 支持30s和10s放电时间点的测量
   - 自动处理不同SOC点的工步数据

## 使用说明

### 系统要求
- Microsoft Excel 2016或更高版本
- 启用宏功能
- 建议屏幕分辨率1920x1080或更高

### 配置要求
1. **循环配置表**
   - 中检间隔圈数设置
   - 容量标定方式选择
   - SOC点工步号配置
   - 放电时间设置

2. **数据文件要求**
   - 循环数据文件（工步数据表）
   - 中检容量数据文件（工步数据表）
   - 中检DCR数据文件（详细数据表）

### 操作步骤
1. 在文件信息表中填写相关文件名
2. 设置循环配置信息
3. 点击"输出报告"按钮生成测试报告
4. 查看生成的数据表格和图表
5. 可选：导出报告为Excel或PDF格式

### 输出说明
生成的报告包含：
1. 基本数据表
   - 循环圈数
   - 容量数据
   - 能量数据
   - 保持率数据

2. DCIR数据表
   - 90% SOC的DCIR值
   - 50% SOC的DCIR值
   - 10% SOC的DCIR值

3. DCIR Rise数据表
   - 各SOC点的DCIR增长率

4. 数据可视化图表
   - 容量和能量随循环圈数的变化散点图
   - 中检DCR和DCR增长率随循环圈数的变化散点图
   - 自动调整的图表样式和颜色

## 注意事项
1. 确保所有输入文件格式正确
2. 正确配置工步号信息
3. 数据异常时检查日志输出
4. 大数据量处理时可能需要较长时间
5. 建议定期备份生成的报告文件

## 错误处理
- 所有错误信息会记录在日志中
- 主要错误类型包括：
  - 文件不存在或无法访问
  - 数据格式错误或不兼容
  - 工步号配置错误
  - 计算过程异常
  - 内存不足（处理大量数据时）

## 维护与更新
- 代码中包含详细的注释和错误处理，便于后续维护和更新
- 模块化设计便于功能扩展和修改
- 如需修改，请参考相应模块的注释说明
- 建议定期检查并更新计算公式和处理逻辑

## 技术支持
如有问题或建议，请联系开发团队。 